<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GSR APP</title>
    <script type="module" crossorigin src="/gsr-app/assets/index-Dx0LlVaC.js"></script>
    <link rel="stylesheet" crossorigin href="/gsr-app/assets/index-CGn20kaT.css">
  </head>
  <body>
    <div id="root"></div>
  <!-- PS-YESTERDAY-MAX-ENDDATE -->
<script>
(function(){
  // ===== Local date helpers =====
  function sod(d){ return new Date(d.getFullYear(), d.getMonth(), d.getDate()); }
  function fmtYMD(d){ return d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0')+'-'+String(d.getDate()).padStart(2,'0'); }
  function yest(){ var d=new Date(); d.setDate(d.getDate()-1); return sod(d); }
  var Y = yest(), Ystr = fmtYMD(Y);

  // ===== Parse helpers =====
  var MONTHS = {jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,sept:8,oct:9,nov:10,dec:11};
  function parseLooseLocal(s){
    if(!s) return null; s=(''+s).trim();
    // ISO yyyy-mm-dd
    var m = s.match(/^(\d{4})-(\d{2})-(\d{2})$/); 
    if(m){ var d = new Date(+m[1],+m[2]-1,+m[3]); return isNaN(d)?null:sod(d); }
    // DD/MM/YYYY (UK)
    m = s.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);
    if(m){ var d2 = new Date(+m[3],+m[2]-1,+m[1]); return isNaN(d2)?null:sod(d2); }
    // Natural language ARIA like "Friday, 10 October 2025" or "October 10, 2025" or "Choose Wednesday, 8 Jan 2026"
    var t = s.replace(/choose\s+|\bselect(ed)?\b|\b(un)?available\b/gi,'').replace(/[,]/g,' ').replace(/\s+/g,' ').trim();
    // Try "DD Month YYYY"
    m = t.match(/^(\d{1,2})\s+([A-Za-z]{3,})\s+(\d{4})$/);
    if(m){ var mm = MONTHS[m[2].slice(0,3).toLowerCase()]; if(mm!=null){ var d3=new Date(+m[3],mm,+m[1]); return isNaN(d3)?null:sod(d3);} }
    // Try "Month DD YYYY"
    m = t.match(/^([A-Za-z]{3,})\s+(\d{1,2})\s+(\d{4})$/);
    if(m){ var mm2 = MONTHS[m[1].slice(0,3).toLowerCase()]; if(mm2!=null){ var d4=new Date(+m[3],mm2,+m[2]); return isNaN(d4)?null:sod(d4);} }
    // Fallback
    var d5 = new Date(s); return isNaN(d5)?null:sod(d5);
  }

  // ===== Clamp inputs =====
  function clampValue(el){
    var d = parseLooseLocal(el.value);
    if(!d) return;
    if(d>Y){
      if(el.type && el.type.toLowerCase()==='date'){ el.value = Ystr; }
      else if(/\d{4}-\d{2}-\d{2}/.test(el.value)){ el.value = Ystr; }
      else if(/\d{1,2}\/\d{1,2}\/\d{4}/.test(el.value)){
        var dd=String(Y.getDate()).padStart(2,'0'), mm=String(Y.getMonth()+1).padStart(2,'0'), yyyy=Y.getFullYear();
        el.value = dd+'/'+mm+'/'+yyyy;  // UK-friendly
      } else { el.value = Ystr; }
    }
  }
  function wireInput(el){
    try{
      if(el.type && el.type.toLowerCase()==='date'){ el.setAttribute('max', Ystr); }
      if(!el.value) el.value = Ystr;
      ['input','change','focus','blur','click','keyup','paste'].forEach(function(evt){
        el.addEventListener(evt, function(){ clampValue(el); });
      });
      clampValue(el);
    }catch(e){}
  }

  // ===== Hard-disable calendar day cells beyond Y =====
  function disableCell(node){
    node.setAttribute('aria-disabled','true');
    node.setAttribute('disabled','');
    node.classList.add('ps-disabled-date');
    node.style.pointerEvents = 'none';
    node.style.opacity = '0.35';
    node.style.filter = 'grayscale(1)';
    // Remove handlers if present
    try{ node.onclick=null; node.onmousedown=null; node.onmouseup=null; node.onkeydown=null; node.onkeyup=null; }catch(e){}
  }

  function maybeDisableCell(node){
    // Many libs put a date in aria-label / data-* / title / text content
    var candidates = [
      node.getAttribute && node.getAttribute('aria-label'),
      node.getAttribute && node.getAttribute('data-date'),
      node.getAttribute && node.getAttribute('title'),
      node.textContent
    ].filter(Boolean);
    for(var i=0;i<candidates.length;i++){
      var d = parseLooseLocal(candidates[i]);
      if(d && d>Y){ disableCell(node); return true; }
    }
    // Some libs wrap date in a child span/button â€” peek inside
    var inner = node.querySelector && node.querySelector('[aria-label],[data-date],[title]');
    if(inner){
      var v = inner.getAttribute('aria-label')||inner.getAttribute('data-date')||inner.getAttribute('title');
      var di = parseLooseLocal(v);
      if(di && di>Y){ disableCell(node); return true; }
    }
    return false;
  }

  function sweepCalendars(){
    // Common calendar structures: gridcells, buttons, td/div with ARIA labels
    var selectors = [
      '[role="gridcell"]',
      'button[aria-label]', 'td[aria-label]', 'div[aria-label]', 'span[aria-label]',
      'button[data-date]', 'td[data-date]', 'div[data-date]', 'span[data-date]',
      '.react-datepicker__day', '.ant-picker-cell', '.MuiPickersDay-root',
      '.DayPicker-Day', '.flatpickr-day', '.ui-datepicker-calendar td a, .ui-datepicker-calendar td'
    ];
    var nodes = [];
    selectors.forEach(function(s){
      try{ document.querySelectorAll(s).forEach(function(n){ nodes.push(n); }); }catch(e){}
    });
    var touched = 0;
    nodes.forEach(function(n){ if(!n.classList || !n.classList.contains('ps-disabled-date')){ if(maybeDisableCell(n)) touched++; } });
    return touched;
  }

  function applyAll(withLog){
    // Inputs (broad match)
    var inputs = [];
    ['input[type="date"]','input.flatpickr-input','input.hasDatepicker','input[data-role*="date"]','input[data-type*="date"]','input[name*="date" i]','input[id*="date" i]','input[name*="end" i]','input[id*="end" i]'].forEach(function(s){
      try{ document.querySelectorAll(s).forEach(function(n){ if(inputs.indexOf(n)<0) inputs.push(n); }); }catch(e){}
    });
    inputs.forEach(wireInput);

    // Calendars
    var disabledCount = sweepCalendars();

    if(withLog){
      console.info('[EndDateCap+Cells] inputs=', inputs.length, 'cellsDisabled=', disabledCount, 'Y=', Ystr);
      if(inputs.length===0 && disabledCount===0){
        console.warn('[EndDateCap+Cells] No matches. If you use a specific picker (MUI/AntD/React-DatePicker/etc.), tell me which one.');
      }
    }
  }

  // Early style for greyed cells (in case inline style is stripped)
  (function ensureStyle(){
    if(document.getElementById('ps-datecap-style')) return;
    var css = '.ps-disabled-date{pointer-events:none!important;opacity:.35!important;filter:grayscale(1)!important;cursor:not-allowed!important;}';
    var st = document.createElement('style'); st.id='ps-datecap-style'; st.textContent = css; document.head.appendChild(st);
  })();

  // Initial + retries + SPA observe
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function(){ applyAll(true); });
  } else { applyAll(true); }
  var t0 = Date.now(), iv = setInterval(function(){ applyAll(false); if(Date.now()-t0>6000) clearInterval(iv); }, 350);
  try{
    new MutationObserver(function(m){ applyAll(false); }).observe(document.documentElement, {childList:true, subtree:true});
  }catch(e){}
})();
</script>
<!-- PS-YESTERDAY-MAX-ENDDATE -->
</body>
</html>



